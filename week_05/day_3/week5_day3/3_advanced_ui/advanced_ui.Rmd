---
title: "Advanced UI"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
    css: styles.css
  pdf_document:
    number_sections: no
    toc: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.align = 'center')
```

\newpage

# Learning Objectives<br>

* Know how to include HTML in a Shiny app
* Know how to include CSS in a Shiny app
* Be able to use themes and UI layouts in Shiny

\hfill 

# Introduction

So far we have looked at a very simple UI with minimal styling. Shiny's preset UI functions make it easy to quickly create an app that looks pretty good. However, Shiny also allows you to fully customize the app's design yourself using Shiny functions, or by implementing HTML, CSS or JavaScript code inside your app's code. There are also pre-existing 'themes' that you can use for a quick styling of your app. In this lesson we will briefly cover how to incorporate HTML and CSS into your Shiny app, as well as how to use `shinythemes` and different layouts using `tabsetPanel` and `fluidRow`.

\hfill

# HTML in Shiny Apps

## What is HTML?

HTML **(Hypertext Markup Language)** is the standard markup language used to define the structure of a webpage.

You do not need to know HTML to use Shiny, but you can elevate the UI of your app by adding custom HTML that is not provided by available Shiny functions. To format e.g. a line of text you have to wrap it in a pair of commands specified with angle brackets `<` and `>`. The commands `<i>` and `</i>` can be referred to as **opening tags** and **closing tags** respectively, and in this particular case the HTML tags indicate that the text between them should be in italics.

## Shiny writes HTML for you

When you create a UI object in Shiny, Shiny generates HTML. Since Shiny creates websites, and the structure of websites are defined using HTML, this is basically how it has to work! 

You can see the HTML that Shiny has created by just printing the object generated by `fluidPage`. For example, here's how we defined the UI in our Olympics app, and below we can see the HTML.

\hfill 

```{r, eval=FALSE}
library(shiny)

ui <- fluidPage(
  titlePanel("Title"),

  sidebarLayout(
    sidebarPanel(
      
      radioButtons("season_input",
        "Summer or Winter Olympics?",
        choices = c("Summer", "Winter")
      ),
      
      selectInput("team_input",
        "Which Team?",
        choices = c("United States",
                    "Soviet Union",
                    "Germany",
                    "Italy",
                    "Great Britain")
      )
    ),

    mainPanel(
      "Main"
    )
  )
)

ui
```

\hfill

```{r, eval = FALSE}
<div class="container-fluid">
  <h2>Title</h2>
  <div class="row">
    <div class="col-sm-4">
      <form class="well">
        <div id="season_input" class="form-group shiny-input-radiogroup shiny-input-container">
          <label class="control-label" for="season_input">Summer or Winter Olympics?</label>
          <div class="shiny-options-group">
            <div class="radio">
              <label>
                <input type="radio" name="season_input" value="Summer" checked="checked"/>
                <span>Summer</span>
              </label>
            </div>
            <div class="radio">
              <label>
                <input type="radio" name="season_input" value="Winter"/>
                <span>Winter</span>
              </label>
            </div>
          </div>
        </div>
        <div class="form-group shiny-input-container">
          <label class="control-label" for="team_input">Which Team?</label>
          <div>
            <select id="team_input"><option value="United States" selected>United States</option>
<option value="Soviet Union">Soviet Union</option>
<option value="Germany">Germany</option>
<option value="Italy">Italy</option>
<option value="Great Britain">Great Britain</option></select>
            <script type="application/json" data-for="team_input" data-nonempty="">{}</script>
          </div>
        </div>
      </form>
    </div>
    <div class="col-sm-8">Main</div>
  </div>
</div>
```

Don't worry if you don't understand what this HTML is doing. The whole point of Shiny is that you don't need to understand how HTML works to write it. But you may be able to make out the different parts of your Shiny code, e.g. the names and labels of the different widgets, as well as the widget types themself.


## Using `tags` for HTML

You can't write HTML directly in your Shiny code. R needs to be able to understand which things are R code, which things are HTML and which are just plain text.

There are two options for including HTML in your Shiny app. The first is to use the functions found inside `tags`. When you load in the `shiny` package, you have access to `tags`, which is a big list containing functions that generate HTML. To see the full list of the **181 functions** inside `tags`, you can run `names(tags)` in the RStudio console. 


For example, to use the `<i>`  and `</i>` tags, you ask for the `i` function from inside `tags`.

\hfill

```{r, eval = FALSE}
tags$i("some text")
```

```{r, echo=FALSE, out.width = '80%', fig.align = "left"}
knitr::include_graphics("images/some_text_italics.png")
```



```{r, eval = FALSE}
tags$b("Some bold text")
```

```{r, echo=FALSE, out.width = '80%', fig.align = "left"}
knitr::include_graphics("images/some_bold_text.png")
```


Some HTML tags need to have attributes. Attributes can be given with named arguments to the function.

```{r, eval = FALSE}
tags$a("CodeClan's Website", href = "https://codeclan.com/")
```

```{r, echo=FALSE, out.width = '80%', fig.align = "left"}
knitr::include_graphics("images/link.png")
```


\hfill

Let's try these in our app we made in the last lesson. **Here is the code for the app from the last lesson**

\hfill

```{r, eval = FALSE}
library(shiny)
library(tidyverse)

olympics_overall_medals <- read_csv("data/olympics_overall_medals.csv")
all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  titlePanel("Olympic Medals"),
  
  sidebarLayout(
    sidebarPanel(
      radioButtons("season_input",
                   "Summer or Winter Olympics?",
                   choices = c("Summer", "Winter")
      ),
      
      selectInput("team_input",
                  "Which Team?",
                  choices = all_teams
      )
    ),
    
    mainPanel(
      plotOutput("medal_plot")
    )
  )
)

server <- function(input, output) {
  
  output$medal_plot <- renderPlot({
    olympics_overall_medals %>%
      filter(team == input$team_input) %>%
      filter(season == input$season_input) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
  
}

shinyApp(ui = ui, server = server)
```


\hfill


Let's first add formatting to our heading, alter the text in it, and then add a link.  We will:

* Make the title heading size 1 by using the `<h1>` tag to the `titlePanel` section. 
* Make the text "Summer or Winter Olympics?" be in italics, and "Which Team?" be in bold.
* Add a link to the Olympics website (https://www.Olympic.org/) underneath the plot.

\hfill

```{r, eval = FALSE}
library(tidyverse)
library(shiny)

olympics_overall_medals <- read_csv("data/olympics_overall_medals.csv")
all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  
  # ADDING A TITLE TAG HERE - FIRST QUESTION
  titlePanel(tags$h1("Olympic Medals")),

    sidebarLayout(
      sidebarPanel(
        
        # ADDING THE FORMATTING HERE - SECOND QUESTION
        radioButtons("season_input",
          tags$i("Summer or Winter Olympics?"),
          choices = c("Summer", "Winter")
        ),
        
        selectInput("team_input",
          tags$b("Which Team?"),
          choices = all_teams
        )
    ),

    mainPanel(
      plotOutput("medal_plot"), 
      
      # ADDING THE LINK HERE - QUESTION 3
      tags$a("The Olympics website", href = "https://www.Olympic.org/")
    )
  )
)

server <- function(input, output) {
  output$medal_plot <- renderPlot({
    
    olympics_overall_medals %>%
      filter(team == input$team_input) %>%
      filter(season == input$season_input) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
}

shinyApp(ui = ui, server = server)
```

\hfill


This should give out the following:

\hfill

```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/html_task.png")
```

\hfill

To add raw HTML into your shiny app, use the `HTML()` function. `HTML()` takes a character string and returns it as HTML (a special class of object in Shiny).

For example, say we wanted a break in between our radio buttons and input selector. We can do this by using the raw HTML tag `<br>` (break) wrapped in `HTML()`.

```{r,eval = FALSE}
library(tidyverse)
library(shiny)

olympics_overall_medals <- read_csv("data/olympics_overall_medals.csv")
all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(

  titlePanel(tags$h1("Olympic Medals")),

    sidebarLayout(
      sidebarPanel(

        radioButtons("season_input",
          tags$i("Summer or Winter Olympics?"),
          choices = c("Summer", "Winter")
        ),
        
        # ADD A BREAK USING RAW HTML
        HTML("<br><br><br>"),
        
        selectInput("team_input",
          tags$b("Which Team?"),
          choices = all_teams
        )
    ),

    mainPanel(
      plotOutput("medal_plot"), 

      tags$a("The Olympics website", href = "https://www.Olympic.org/")
    )
  )
)

server <- function(input, output) {
  output$medal_plot <- renderPlot({
    
    olympics_overall_medals %>%
      filter(team == input$team_input) %>%
      filter(season == input$season_input) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
}

shinyApp(ui = ui, server = server)
```

This should give out the following:

\hfill

```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/html_task_break.png")
```

\hfill\break

# Themes

## `shinythemes`

You can quickly change the look of your app by using any one of the themes available in the `shinythemes` package, rather than worrying about HTML. 

You can see all the themes available here: https://shiny.rstudio.com/gallery/shiny-theme-selector.html

Inside the `fluidPage` function, give the `theme` argument a value, `shinytheme("<name-of-theme>")`. For example, here's our Olympics app using the "flatly" theme.

\hfill 

```{r, eval = FALSE}
library(shiny)
library(tidyverse)
library(shinythemes)

olympics_overall_medals <- read_csv("data/olympics_overall_medals.csv")

all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  theme = shinytheme("flatly"),
  
  titlePanel("Olympic Medals"),

  sidebarLayout(
    sidebarPanel(
      radioButtons("season_input",
        "Summer or Winter Olympics?",
        choices = c("Summer", "Winter")
      ),

      selectInput("team_input",
        "Which Team?",
        choices = all_teams
      )
    ),

    mainPanel(
      plotOutput("medal_plot"), 
      
      # ADDING THE LINK HERE - QUESTION 3
      tags$a("The Olympics website", href = "https://www.Olympic.org/")
    )
  )
)

server <- function(input, output) {
  
  output$medal_plot <- renderPlot({
    olympics_overall_medals %>%
      filter(team == input$team_input) %>%
      filter(season == input$season_input) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
}

shinyApp(ui = ui, server = server)
```

\hfill 

```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/flatly_theme.png")
```
\hfill

This is by far the easiest way to control the way your output looks. You can write your own custom themes, but that involves something know as CSS. 

\hfill

# CSS in Shiny Apps (Optional)

## What is CSS?

CSS (**Cascading Style Sheets**) is a style language that lets you further control and design visual aspects of your Shiny app. CSS describes how HTML elements are to be displayed, for example the font, colour, size and spacing of text. Since we now know that the Shiny UI is actually an HTML document, it makes sense that we can use CSS to style our Shiny app.

[There are many ways to add a CSS style sheet to a Shiny app](https://shiny.rstudio.com/articles/css.html), but we will go through how to add one using a `www` subdirectory. The `www` subdirectory should be a folder inside the same folder that contains your Shiny app. This mimics software dev processes, and you don't need to worry too much about this. 

We could spend weeks tweaking the CSS of an app, but for today we will start from an already existing style sheet to get a feel for what is possible with CSS. You should have a CSS file, called 'shiny_example_style.css'. Place this file inside a folder called `www`, and make sure this folder is in the same folder as your current shiny app.

We can open the 'shiny_example_style.css' file inside RStudio, and take a look at what's inside.

First of all, we notice a general pattern in how the code is organised. We have a type of object, such as an HTML h1 heading, which is then followed by `{}` filled with a bunch of arguments, such as the font size and color. [There are several ways to refer to objects](https://www.w3schools.com/cssref/css_selectors.asp), but the two used in this CSS file are by class and by HTML tags. 

To use the style sheet, we add it to a `theme` argument inside our `fluidPage`. There are endless ways to customize your Shiny app, but [colour palettes](https://www.w3schools.com/colors/colors_palettes.asp) and [fonts](https://fonts.google.com) are a good way to get started.

\hfill

```{r, eval = FALSE}
library(shiny)
library(tidyverse)

olympics_overall_medals <- read_csv("data/olympics_overall_medals.csv")
all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  theme = "shiny_example_style.css",
  
  titlePanel(tags$h1("Olympic Medals")),

    sidebarLayout(
      sidebarPanel(
        
        radioButtons("season_input",
          tags$i("Summer or Winter Olympics?"),
          choices = c("Summer", "Winter")
        ),
        
        selectInput("team_input",
          tags$i("Which Team?"),
          choices = all_teams
        )
    ),

    mainPanel(
      plotOutput("medal_plot"), 
      
      # ADDING THE LINK HERE - QUESTION 3
      tags$a("The Olympics website", href = "https://www.Olympic.org/")
    )
  )
)

server <- function(input, output) {
  output$medal_plot <- renderPlot({
    
    olympics_overall_medals %>%
      filter(team == input$team_input) %>%
      filter(season == input$season_input) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
}

shinyApp(ui = ui, server = server)
```


```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/olympics_css.png")
```



# Other Layouts 

So far we've only been using the sidebar layout. However, there are a lot of other layouts available in Shiny. These are particularly useful for creating more complex layouts, with multiple outputs and many widgets.

In this lesson we are just going to discuss the grid layout and adding tabs to a layout. More layouts can be seen on the Shiny website: https://shiny.rstudio.com/articles/layout-guide.html

\hfill

## Grid layout (Optional)

One of the most useful layouts is the grid layout. This lets you build up your page as a series of rows and columns. 

You start this layout with `fluidPage`, just like you did with the sidebar layout. However, instead of using `sidebarLayout`, `sidebarPanel` and `mainPanel` you create your layout using a mixture of 

* `fluidRow`

and

* `column`

The column function has to be inside a `fluidRow`. You specify the size of a column by giving it a number between 1 and 12. The size of all the columns in a row must add up to 12.

Here is a schematic of how rows and columns work within Shiny

```{r, echo = FALSE, out.width= "80%"}
knitr::include_graphics("images/columns.png")
```
\hfill 

You can have as many rows as you want (we've shown one here), and the size of these rows will be dictated by what you put in them: if you put a plot in the row, it will be taller. If all you do is put a button in the row, it will be shorter.

You can only have 12 columns in a dashboard page though. This determines the width of the dashboard page.   

\hfill

Let's look at using these in our app. Instead of having our radio buttons and select input dropdowns in the sidebar, what we want to do is have the following:

```{r, echo = FALSE, out.width= "80%"}
knitr::include_graphics("images/fluid_row.png")
```


Let's code out our Olympics app to look like this now. 

\hfill 

```{r, eval = FALSE}
library(shiny)
library(tidyverse)
library(shinythemes)

olympics_overall_medals <- read_csv("data/olympics_overall_medals.csv")

all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  
  titlePanel("Olympic Medals"),
  
  # need to move the plot up here because we want that up top
  plotOutput("medal_plot"),
  
  # then need to set up fluidRow as we want two things within this row
  fluidRow(
    
    # first column for our radio button, make this 6 wide 
    column(6, 
      radioButtons("season_input",
        "Summer or Winter Olympics?",
        choices = c("Summer", "Winter")
      )
    ),
    
    # second column for input, make this 6 wide as well (so it adds up to 12)
    column(6,
      selectInput("team_input",
        "Which Team?",
        choices = all_teams
      )   
    )
  )
)

server <- function(input, output) {
  
  output$medal_plot <- renderPlot({
    olympics_overall_medals %>%
      filter(team == input$team_input) %>%
      filter(season == input$season_input) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
}

shinyApp(ui = ui, server = server)
```


\hfill

```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/grid_layout.png")
```

\hfill

Note that since the plot is the only thing in its row, then we don't need to include any `fluidRow` or `columns`. By default, it will fill 1 row and 12 columns with that plot. 


**Task - 5 mins** 

1. Add a third column to the bottom row, which only has a link the the Olympics website.

2. Try out different sizes for the columns

**Answer**

\hfill

```{r, eval = FALSE}

library(shiny)
library(tidyverse)
library(shinythemes)

olympics_overall_medals <- read_csv("data/olympics_overall_medals.csv")

all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  
  titlePanel("Olympic Medals"),
  
  plotOutput("medal_plot"),
  
  fluidRow(
    column(4, 
      radioButtons("season_input",
        "Summer or Winter Olympics?",
        choices = c("Summer", "Winter")
      )
    ),
    column(4,
      selectInput("team_input",
        "Which Team?",
        choices = all_teams
      )   
    ),
    column(4,
      tags$a("The Olympics website",
             href = "https://www.Olympic.org/")
    )
  )

)

server <- function(input, output) {
  
  output$medal_plot <- renderPlot({
    olympics_overall_medals %>%
      filter(team == input$team_input) %>%
      filter(season == input$season_input) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
  
}

shinyApp(ui = ui, server = server)


```


```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/grid_answer.png")
```


\newpage

## Adding tabs

Tabs aren't strictly a new layout, they can be added into any layout. You use the function `tabsetPanel` with different `tabPanel` elements inside it. 

The first argument to `tabPanel` is the name at the top of the tab, and the second argument is the UI elements you are adding to the tab.

\hfill

```{r, eval = FALSE}

tabsetPanel(
  
      tabPanel("First Tab",
        "First Tab Content goes here"
      ), 
      
      tabPanel("Second Tab",
        "Second Tab Content goes here"
      ), 
      
      tabPanel("Third Tab",
        "Third Tab Content goes here"
      )
      
)
```

\hfill 

Let's edit our Olympics app now, to have tabs instead of rows. We will aim to have the following:

* a tab that has only our plot  
* a tab that has only our season radio button  
* a tab that has only the team input  

\hfill

```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/tabset_layout.png")
```

We can code this out now: 

\hfill

```{r, eval = FALSE}
library(shiny)
library(tidyverse)
library(shinythemes)

olympics_overall_medals <- read_csv("data/olympics_overall_medals.csv")

all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  
  titlePanel("Olympic Medals"),
  
  tabsetPanel(
        tabPanel("Plot",
          plotOutput("medal_plot")
        ), 
        
        tabPanel("Which season",
          radioButtons("season_input",
            "Summer or Winter Olympics?",
            choices = c("Summer", "Winter")
          )
        
        ), 
        
        tabPanel("Which team?",
          
          selectInput("team_input",
            "Which Team?",
            choices = all_teams
          )
        
        )
  )
)

server <- function(input, output) {
  
  output$medal_plot <- renderPlot({
    
    olympics_overall_medals %>%
      filter(team == input$team_input) %>%
      filter(season == input$season_input) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
  
}

shinyApp(ui = ui, server = server)
```

\hfill 

```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/tab_layout.png")
```


**Task - 5 mins** 

Add another tab which only contains a link to the Olympics website.

**Answer**

\hfill 

```{r, eval = FALSE}

library(shiny)
library(tidyverse)
library(shinythemes)

olympics_overall_medals <- read_csv("data/olympics_overall_medals.csv")

all_teams <- unique(olympics_overall_medals$team)

ui <- fluidPage(
  
  titlePanel("Olympic Medals"),
  
  tabsetPanel(
        tabPanel("Plot",
          plotOutput("medal_plot")
        ), 
        
        tabPanel("Which season",
          radioButtons("season_input",
            "Summer or Winter Olympics?",
            choices = c("Summer", "Winter")
          )
        ), 
        
        tabPanel("Which team?",
          selectInput("team_input",
            "Which Team?",
            choices = all_teams
          )
        
        ),
        
        tabPanel("Link to Olympics site",
          
          tags$a("The Olympics website",
             href = "https://www.olympic.org/")
        
        )
  )
)

server <- function(input, output) {
  
  output$medal_plot <- renderPlot({
    olympics_overall_medals %>%
      filter(team == input$team_input) %>%
      filter(season == input$season_input) %>%
      ggplot() +
      aes(x = medal, y = count, fill = medal) +
      geom_col()
  })
}

shinyApp(ui = ui, server = server)


```

\hfill 

```{r, echo=FALSE, out.width = '100%'}
knitr::include_graphics("images/link_tab_task.png")
```

\hfill


## Summary

That's the advanced UI lesson for today. We have learned how to:

* Add in basic HTML formatting to a Shiny App  
* Add in themes to our apps  
* Work with CSS files  
* Work with fluidRow and column output  
* Work with tabPanel layouts  